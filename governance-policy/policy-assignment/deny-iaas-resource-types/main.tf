data "azurerm_subscription" "current" {}

output "subscription_id" {
  value = "${data.azurerm_subscription.current.id}"
}

data "azurerm_policy_definition" "definition" {
  display_name = "POL-Enforce not allowed resource types"
}

output "policy_definition_id" {
  value = "${data.azurerm_policy_definition.definition.id}"
}

resource "azurerm_policy_assignment" "policy" {
  name                 = "POL-Deny IaaS resource types"
  scope                = data.azurerm_subscription.current.id
  policy_definition_id = data.azurerm_policy_definition.definition.id
  display_name         = "POL-Deny IaaS resource types"

parameters = <<PARAMETERS
    {
        "listOfResourceTypesNotAllowed": {
            "value": [
                "microsoft.classiccompute/capabilities",
                "microsoft.classiccompute/checkdomainnameavailability",
                "microsoft.classiccompute/domainnames",
                "microsoft.classiccompute/domainnames/capabilities",
                "microsoft.classiccompute/domainnames/internalloadbalancers",
                "microsoft.classiccompute/domainnames/servicecertificates",
                "microsoft.classiccompute/domainnames/slots",
                "microsoft.classiccompute/domainnames/slots/roles",
                "microsoft.classiccompute/domainnames/slots/roles/metricdefinitions",
                "microsoft.classiccompute/domainnames/slots/roles/metrics",
                "microsoft.classiccompute/movesubscriptionresources",
                "microsoft.classiccompute/operatingsystemfamilies",
                "microsoft.classiccompute/operatingsystems",
                "microsoft.classiccompute/operations",
                "microsoft.classiccompute/operationstatuses",
                "microsoft.classiccompute/quotas",
                "microsoft.classiccompute/resourcetypes",
                "microsoft.classiccompute/validatesubscriptionmoveavailability",
                "microsoft.classiccompute/virtualmachines",
                "microsoft.classiccompute/virtualmachines/diagnosticsettings",
                "microsoft.classiccompute/virtualmachines/metricdefinitions",
                "microsoft.classiccompute/virtualmachines/metrics",
                "microsoft.classicinfrastructuremigrate/classicinfrastructureresources",
                "microsoft.classicnetwork/capabilities",
                "microsoft.classicnetwork/expressroutecrossconnections",
                "microsoft.classicnetwork/expressroutecrossconnections/peerings",
                "microsoft.classicnetwork/gatewaysupporteddevices",
                "microsoft.classicnetwork/networksecuritygroups",
                "microsoft.classicnetwork/operations",
                "microsoft.classicnetwork/quotas",
                "microsoft.classicnetwork/reservedips",
                "microsoft.classicnetwork/virtualnetworks",
                "microsoft.classicnetwork/virtualnetworks/remotevirtualnetworkpeeringproxies",
                "microsoft.classicnetwork/virtualnetworks/virtualnetworkpeerings",
                "microsoft.classicstorage/capabilities",
                "microsoft.classicstorage/checkstorageaccountavailability",
                "microsoft.classicstorage/disks",
                "microsoft.classicstorage/images",
                "microsoft.classicstorage/operations",
                "microsoft.classicstorage/osimages",
                "microsoft.classicstorage/osplatformimages",
                "microsoft.classicstorage/publicimages",
                "microsoft.classicstorage/quotas",
                "microsoft.classicstorage/storageaccounts",
                "microsoft.classicstorage/storageaccounts/blobservices",
                "microsoft.classicstorage/storageaccounts/fileservices",
                "microsoft.classicstorage/storageaccounts/metricdefinitions",
                "microsoft.classicstorage/storageaccounts/metrics",
                "microsoft.classicstorage/storageaccounts/queueservices",
                "microsoft.classicstorage/storageaccounts/services",
                "microsoft.classicstorage/storageaccounts/services/metricdefinitions",
                "microsoft.classicstorage/storageaccounts/services/diagnosticsettings",
                "microsoft.classicstorage/storageaccounts/services/metrics",
                "microsoft.classicstorage/storageaccounts/tableservices",
                "microsoft.classicstorage/storageaccounts/vmimages",
                "microsoft.classicstorage/vmimages",
                "microsoft.classicsubscription/operations",
                "microsoft.compute/availabilitysets",
                "microsoft.compute/diskencryptionsets",
                "microsoft.compute/disks",
                "microsoft.compute/galleries",
                "microsoft.compute/galleries/applications",
                "microsoft.compute/galleries/applications/versions",
                "microsoft.compute/galleries/images",
                "microsoft.compute/galleries/images/versions",
                "microsoft.compute/hostgroups",
                "microsoft.compute/hostgroups/hosts",
                "microsoft.compute/images",
                "microsoft.compute/locations",
                "microsoft.compute/locations/artifactpublishers",
                "microsoft.compute/locations/capsoperations",
                "microsoft.compute/locations/diskoperations",
                "microsoft.compute/locations/loganalytics",
                "microsoft.compute/locations/operations",
                "microsoft.compute/locations/publishers",
                "microsoft.compute/locations/runcommands",
                "microsoft.compute/locations/systeminfo",
                "microsoft.compute/locations/usages",
                "microsoft.compute/locations/virtualmachines",
                "microsoft.compute/locations/vmsizes",
                "microsoft.compute/locations/vsmoperations",
                "microsoft.compute/operations",
                "microsoft.compute/proximityplacementgroups",
                "microsoft.compute/restorepointcollections",
                "microsoft.compute/restorepointcollections/restorepoints",
                "microsoft.compute/sharedvmimages",
                "microsoft.compute/sharedvmimages/versions",
                "microsoft.compute/snapshots",
                "microsoft.compute/virtualmachines",
                "microsoft.compute/virtualmachines/extensions",
                "microsoft.compute/virtualmachines/metricdefinitions",
                "microsoft.compute/virtualmachinescalesets",
                "microsoft.compute/virtualmachinescalesets/extensions",
                "microsoft.compute/virtualmachinescalesets/networkinterfaces",
                "microsoft.compute/virtualmachinescalesets/publicipaddresses",
                "microsoft.compute/virtualmachinescalesets/virtualmachines",
                "microsoft.compute/virtualmachinescalesets/virtualmachines/networkinterfaces",
                "microsoft.network/applicationgatewayavailablerequestheaders",
                "microsoft.network/applicationgatewayavailableresponseheaders",
                "microsoft.network/applicationgatewayavailableservervariables",
                "microsoft.network/applicationgatewayavailablessloptions",
                "microsoft.network/applicationgatewayavailablewafrulesets",
                "microsoft.network/applicationgateways",
                "microsoft.network/applicationgatewaywebapplicationfirewallpolicies",
                "microsoft.network/applicationsecuritygroups",
                "microsoft.network/azurefirewallfqdntags",
                "microsoft.network/azurefirewalls",
                "microsoft.network/bastionhosts",
                "microsoft.network/bgpservicecommunities",
                "microsoft.network/checkfrontdoornameavailability",
                "microsoft.network/checktrafficmanagernameavailability",
                "microsoft.network/ddoscustompolicies",
                "microsoft.network/connections",
                "microsoft.network/ddosprotectionplans",
                "microsoft.network/dnsoperationresults",
                "microsoft.network/dnsoperationstatuses",
                "microsoft.network/dnszones",
                "microsoft.network/dnszones/a",
                "microsoft.network/dnszones/aaaa",
                "microsoft.network/dnszones/all",
                "microsoft.network/dnszones/caa",
                "microsoft.network/dnszones/cname",
                "microsoft.network/dnszones/mx",
                "microsoft.network/dnszones/ns",
                "microsoft.network/dnszones/ptr",
                "microsoft.network/dnszones/recordsets",
                "microsoft.network/dnszones/soa",
                "microsoft.network/dnszones/srv",
                "microsoft.network/dnszones/txt",
                "microsoft.network/expressroutecircuits",
                "microsoft.network/expressroutecircuits/authorizations",
                "microsoft.network/expressroutecircuits/peerings",
                "microsoft.network/expressroutecrossconnections",
                "microsoft.network/expressroutecrossconnections/peerings",
                "microsoft.network/expressroutecircuits/peerings/connections",
                "microsoft.network/expressroutegateways",
                "microsoft.network/expressroutegateways/expressrouteconnections",
                "microsoft.network/expressrouteports",
                "microsoft.network/expressrouteportslocations",
                "microsoft.network/expressrouteserviceproviders",
                "microsoft.network/firewallpolicies",
                "microsoft.network/firewallpolicies/rulegroups",
                "microsoft.network/frontdooroperationresults",
                "microsoft.network/frontdoors",
                "microsoft.network/frontdoors/backendpools",
                "microsoft.network/frontdoorwebapplicationfirewallmanagedrulesets",
                "microsoft.network/frontdoorwebapplicationfirewallpolicies",
                "microsoft.network/getdnsresourcereference",
                "microsoft.network/internalnotify",
                "microsoft.network/ipgroups",
                "microsoft.network/loadbalancers",
                "microsoft.network/loadbalancers/inboundnatrules",
                "microsoft.network/localnetworkgateways",
                "microsoft.network/locations",
                "microsoft.network/locations/autoapprovedprivatelinkservices",
                "microsoft.network/locations/availabledelegations",
                "microsoft.network/locations/availableprivateendpointtypes",
                "microsoft.network/locations/availableservicealiases",
                "microsoft.network/locations/baremetaltenants",
                "microsoft.network/locations/checkacceleratednetworkingsupport",
                "microsoft.network/locations/checkdnsnameavailability",
                "microsoft.network/locations/checkprivatelinkservicevisibility",
                "microsoft.network/locations/effectiveresourceownership",
                "microsoft.network/locations/nfvoperationresults",
                "microsoft.network/locations/nfvoperations",
                "microsoft.network/webapplicationfirewallpolicies",
                "microsoft.network/vpnsites",
                "microsoft.network/vpnserverconfigurations",
                "microsoft.network/vpngateways/vpnconnections",
                "microsoft.network/vpngateways",
                "microsoft.network/virtualwans/p2svpnserverconfigurations",
                "microsoft.network/virtualwans",
                "microsoft.network/virtualrouters/peerings",
                "microsoft.network/virtualrouters",
                "microsoft.network/virtualnetworktaps",
                "microsoft.network/virtualnetworks/virtualnetworkpeerings",
                "microsoft.network/virtualnetworks/taggedtrafficconsumers",
                "microsoft.network/virtualnetworks/subnets",
                "microsoft.network/virtualnetworks",
                "microsoft.network/virtualnetworkgateways",
                "microsoft.network/virtualhubs/routetables",
                "microsoft.network/virtualhubs",
                "microsoft.network/trafficmanagerusermetricskeys",
                "microsoft.network/trafficmanagerprofiles/heatmaps",
                "microsoft.network/trafficmanagerprofiles",
                "microsoft.network/trafficmanagergeographichierarchies",
                "microsoft.network/serviceendpointpolicies/serviceendpointpolicydefinitions",
                "microsoft.network/serviceendpointpolicies",
                "microsoft.network/routetables/routes",
                "microsoft.network/routetables",
                "microsoft.network/routefilters/routefilterrules",
                "microsoft.network/routefilters",
                "microsoft.network/publicipprefixes",
                "microsoft.network/publicipaddresses",
                "microsoft.network/privatelinkservices/privateendpointconnections",
                "microsoft.network/privatelinkservices",
                "microsoft.network/privateendpoints",
                "microsoft.network/privateendpointredirectmaps",
                "microsoft.network/privatednszones/virtualnetworklinks",
                "microsoft.network/privatednszones/txt",
                "microsoft.network/privatednszones/srv",
                "microsoft.network/privatednszones/soa",
                "microsoft.network/privatednszones/ptr",
                "microsoft.network/privatednszones/mx",
                "microsoft.network/privatednszones/cname",
                "microsoft.network/privatednszones/all",
                "microsoft.network/privatednszones/aaaa",
                "microsoft.network/privatednszones/a",
                "microsoft.network/privatednszones",
                "microsoft.network/privatednsoperationstatuses",
                "microsoft.network/privatednsoperationresults",
                "microsoft.network/p2svpngateways",
                "microsoft.network/operations",
                "microsoft.network/networkwatchers/pingmeshes",
                "microsoft.network/networkwatchers/packetcaptures",
                "microsoft.network/networkwatchers/lenses",
                "microsoft.network/networkwatchers/flowlogs",
                "microsoft.network/networkwatchers/connectionmonitors",
                "microsoft.network/networkwatchers",
                "microsoft.network/networksecuritygroups/securityrules",
                "microsoft.network/networksecuritygroups",
                "microsoft.network/networkprofiles",
                "microsoft.network/networkinterfaces/tapconfigurations",
                "microsoft.network/networkinterfaces",
                "microsoft.network/networkintentpolicies",
                "microsoft.network/networkexperimentprofiles",
                "microsoft.network/natgateways",
                "microsoft.network/locations/virtualnetworkavailableendpointservices",
                "microsoft.network/locations/validateresourceownership",
                "microsoft.network/locations/usages",
                "microsoft.network/locations/supportedvirtualmachinesizes",
                "microsoft.network/locations/setresourceownership",
                "microsoft.network/locations/servicetags",
                "microsoft.network/locations/operations",
                "microsoft.network/locations/operationresults",
                "microsoft.storage/checknameavailability",
                "microsoft.storage/locations",
                "microsoft.storage/locations/asyncoperations",
                "microsoft.storage/locations/checknameavailability",
                "microsoft.storage/locations/deletevirtualnetworkorsubnets",
                "microsoft.storage/locations/usages",
                "microsoft.storage/operations",
                "microsoft.storage/storageaccounts",
                "microsoft.storage/storageaccounts/blobservices",
                "microsoft.storage/storageaccounts/fileservices",
                "microsoft.storage/storageaccounts/fileservices/shares",
                "microsoft.storage/storageaccounts/listaccountsas",
                "microsoft.storage/storageaccounts/listservicesas",
                "microsoft.storage/storageaccounts/managementpolicies",
                "microsoft.storage/storageaccounts/queueservices",
                "microsoft.storage/storageaccounts/services",
                "microsoft.storage/storageaccounts/services/metricdefinitions",
                "microsoft.storage/storageaccounts/tableservices",
                "microsoft.storage/usages",
                "microsoft.storagecache/caches",
                "microsoft.storagecache/caches/storagetargets",
                "microsoft.storagecache/locations",
                "microsoft.storagecache/locations/ascoperations",
                "microsoft.storagecache/operations",
                "microsoft.storagecache/usagemodels",
                "microsoft.storagesync/locations",
                "microsoft.storagesync/locations/checknameavailability",
                "microsoft.storagesync/locations/workflows",
                "microsoft.storagesync/operations",
                "microsoft.storagesync/storagesyncservices",
                "microsoft.storagesync/storagesyncservices/registeredservers",
                "microsoft.storagesync/storagesyncservices/syncgroups",
                "microsoft.storagesync/storagesyncservices/syncgroups/cloudendpoints",
                "microsoft.storagesync/storagesyncservices/syncgroups/serverendpoints",
                "microsoft.storagesync/storagesyncservices/workflows",
                "microsoft.virtualmachineimages/imagetemplates",
                "microsoft.virtualmachineimages/imagetemplates/runoutputs",
                "microsoft.virtualmachineimages/locations",
                "microsoft.virtualmachineimages/locations/operations",
                "microsoft.virtualmachineimages/operations"
            ]
        }
    }
  PARAMETERS
}